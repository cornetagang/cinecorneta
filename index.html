<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cine Corneta</title>
    <link id="app-icon" rel="icon" type="image/png" href="https://res.cloudinary.com/djhgmmdjx/image/upload/v1759209689/u71QEFc_bet4rv.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body class="">

    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <div class="page-wrapper" style="display: none;">
        <header class="main-header">
            <div class="header-container">
                <div class="header-left">
                    <div class="logo">
                        <img id="app-logo" src="https://res.cloudinary.com/djhgmmdjx/image/upload/v1759209688/vgJjqSM_oicebo.png" alt="Cine Corneta Logo" loading="lazy">
                    </div>

                    <nav class="main-nav">
                        <ul>
                            <li><a href="#" class="active" data-filter="all">Inicio</a></li>
                            <li><a href="#" data-filter="movie">Películas</a></li>
                            <li><a href="#" data-filter="series">Series</a></li>
                            <li><a href="#" data-filter="sagas">Universos</a></li>
                            <li><a href="#" data-filter="roulette">Ruleta</a></li>
                            <li><a href="#" data-filter="reviews">Reseñas</a></li>
                            <!--<li><a href="#" data-filter="live" class="nav-live-btn" style="color: #d42279;">Festival</a></li>-->
                        </ul>
                    </nav>
                </div>
                <div class="header-right">
                    <div id="search-container">
                        <input type="text" id="search-input" placeholder="Buscar..." autocomplete="off">
                        <i class="fas fa-search search-icon"></i>
                    </div>

                    <div id="user-profile-container" style="display: none;">
                        <div class="user-dropdown-wrapper">
                            <button id="user-greeting" class="user-greeting-btn">Hola, Usuario</button>
                            <div id="user-menu-dropdown" class="user-menu-dropdown">
                                <a href="#" id="my-list-nav-link" data-filter="my-list" style="display: none;">
                                    <i class="fas fa-list" style="width: 18px;"></i> Mi Lista
                                </a>
                                <a href="#" id="history-nav-link" data-filter="history" style="display: none;">
                                    <i class="fas fa-history" style="width: 18px;"></i> Historial
                                </a>
                                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 5px 10px;"></div>
                                
                                <a href="#" data-filter="profile">
                                    <i class="fas fa-user-circle" style="width: 18px;"></i> Mi Perfil
                                </a>
                                <a href="#" data-filter="settings">
                                    <i class="fas fa-cog" style="width: 18px;"></i> Ajustes de Cuenta
                                </a>
                                <a href="#" id="logout-btn" data-action="logout">
                                    <i class="fas fa-sign-out-alt" style="width: 18px;"></i> Cerrar Sesión
                                </a>
                            </div>
                        </div>
                    </div>

                    <div id="auth-buttons" style="display: flex;">
                        <a href="#" id="login-btn-header" class="btn btn-login">Ingresar</a>
                        <a href="#" id="register-btn-header" class="btn btn-register">Registrarse</a>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section id="hero-section" class="hero-section"></section>

            <div id="carousel-container"></div>

            <div id="full-grid-container" style="display: none;">
                <div class="filter-controls" id="filter-controls">
                    <button id="back-to-sagas-btn" class="sort-btn back-saga-btn" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Universos
                    </button>

                    <div class="custom-dropdown" id="genre-dropdown-visual">
                        <div class="dropdown-trigger" id="genre-trigger">
                            <span id="genre-text">Todos</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="genre-menu-list"></div>
                    </div>
                    
                    <select id="genre-filter" style="display: none !important;"></select>
                    <select id="lang-filter" style="display: none !important;"></select>
                    <select id="sort-by" style="display: none !important;"></select>

                    <div class="custom-dropdown" id="lang-dropdown-visual">
                        <div class="dropdown-trigger" id="lang-trigger">
                            <span id="lang-text">Idioma</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="lang-menu-list"></div>
                    </div>
                    
                    <div class="custom-dropdown" id="sort-dropdown-visual">
                        <div class="dropdown-trigger" id="sort-trigger">
                            <span id="sort-text">Recientes</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="dropdown-menu" id="sort-menu-list"></div>
                    </div>

                    <div id="ucm-sort-buttons" style="display: none;">
                        <button class="sort-btn active" data-sort="release">Orden de Salida</button>
                        <button class="sort-btn" data-sort="chronological">Orden Cronológico</button>
                    </div>
                </div>
                <div class="grid"></div>
            </div>

            <div id="reviews-container" style="display: none;">
                <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; padding: 0 4vw;">
                    <div>
                        <h2 style="font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem; color: var(--text-light); margin: 0;">Reseñas Profesionales</h2>
                        <p style="color: var(--text-muted); font-size: 1.1rem; margin: 5px 0 0 0;">Opiniones reales de expertos en la materia.</p>
                    </div>
                    <button id="open-review-modal-btn" class="btn-primary" style="padding: 15px 30px; font-size: 1.1rem;">
                        <i class="fas fa-edit"></i> Escribir Reseña
                    </button>
                </div>
                <div id="reviews-grid" class="reviews-grid"></div>
            </div>

            <div id="live-tv-section" style="display: none;">
                <div class="live-bg-layer" id="live-bg-image"></div>
                <div class="live-overlay-layer"></div>
                
                <div class="live-content-wrapper">
                    <div class="live-header-container">
                        <h1 id="live-section-title" style="font-family: 'Bebas Neue', sans-serif;">FESTIVAL DE VIÑA 2026</h1>
                    </div>

                    <div class="live-player-container">
                        <video id="embedded-live-video" controls autoplay playsinline></video>
                        </div>

                    <div class="live-footer-container">
                        <p class="live-status"><span class="blink-red"></span> TRANSMISIÓN EN VIVO</p>
                    </div>

                    <div class="festival-schedule-container">
                        <h2 class="schedule-main-title"><i class="fas fa-calendar-alt"></i> PROGRAMACIÓN</h2>
                        
                        <div class="schedule-accordion">
                            <div class="accordion-item">
                                <button class="accordion-header">Domingo 22 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Gloria Estefan</li>
                                        <li><i class="fas fa-laugh-squint"></i> Stefan Kramer</li>
                                        <li><i class="fas fa-microphone"></i> Matteo Bocelli</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-header">Lunes 23 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Juan Luis Guerra</li>
                                        <li><i class="fas fa-laugh-squint"></i> Chiqui Aguayo</li>
                                        <li><i class="fas fa-microphone"></i> Zúmbale Primo</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-header">Martes 24 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Marc Anthony</li>
                                        <li><i class="fas fa-laugh-squint"></i> Edo Caroe</li>
                                        <li><i class="fas fa-microphone"></i> Bacilos</li>
                                    </ul>
                                </div>
                            </div>
                             <div class="accordion-item">
                                <button class="accordion-header">Miércoles 25 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Carlos Vives</li>
                                        <li><i class="fas fa-laugh-squint"></i> Yamila Reyna</li>
                                        <li><i class="fas fa-microphone"></i> Sebastián Yatra</li>
                                    </ul>
                                </div>
                            </div>
                             <div class="accordion-item">
                                <button class="accordion-header">Jueves 26 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Los Bunkers</li>
                                        <li><i class="fas fa-laugh-squint"></i> Fabrizio Copano</li>
                                        <li><i class="fas fa-microphone"></i> Kidd Voodoo</li>
                                    </ul>
                                </div>
                            </div>
                             <div class="accordion-item">
                                <button class="accordion-header">Viernes 27 de Febrero <i class="fas fa-chevron-down"></i></button>
                                <div class="accordion-content">
                                    <ul>
                                        <li><i class="fas fa-star"></i> Duki</li>
                                        <li><i class="fas fa-laugh-squint"></i> Pedro Ruminot</li>
                                        <li><i class="fas fa-microphone"></i> Young Cister</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="my-list-container" style="display: none;">
                <div class="content-header"><h2>Mi Lista</h2></div>
                <div id="my-list-grid" class="grid"></div>
            </div>

            <div id="history-container" style="display: none;">
                <div class="content-header"><h2>Historial de Reproducción</h2></div>
                <div id="history-grid" class="grid"></div>
            </div>

            <div id="sagas-hub-container" style="display: none;">
                <div class="content-header"><h1 class="main-title"></h1></div>
                <div class="sagas-grid" id="sagas-grid-dynamic"></div>
            </div>

            <div id="profile-hub-container" class="content-container" style="display: none;">
                <div class="profile-hub-header">
                    <h2>Mi Perfil</h2>
                    <p id="profile-hub-email">Cargando...</p>
                </div>
                
                <div id="hub-logged-in-content" style="display: none;">
                    
                    <h4 style="color: #666; font-size: 0.9rem; margin: 10px 0 10px 5px; text-transform: uppercase;">Explorar</h4>

                    <!--<a href="#" class="profile-hub-menu-item" data-filter="live"> <i class="fas fa-microphone-alt" style="color: #d42279;"></i> <span>Festival de Viña 2026</span> </a>-->

                    <a href="#" class="profile-hub-menu-item" data-filter="reviews">
                        <i class="fas fa-star" style="color: #00f2ff;"></i>
                        <span>Reseñas</span>
                    </a>
                    
                    <a href="#" class="profile-hub-menu-item" data-filter="roulette">
                        <i class="fas fa-dice" style="color: #ffffff;"></i>
                        <span>Ruleta</span>
                    </a>

                    <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;"></div>

                    <h4 style="color: #666; font-size: 0.9rem; margin: 10px 0 10px 5px; text-transform: uppercase;">Mi Cuenta</h4>

                    <a href="#" class="profile-hub-menu-item" data-filter="my-list">
                        <i class="fas fa-list"></i><span>Mi Lista</span>
                    </a>
                    <a href="#" class="profile-hub-menu-item" data-filter="history">
                        <i class="fas fa-history"></i><span>Historial</span>
                    </a>
                    <a href="#" class="profile-hub-menu-item" data-filter="profile">
                        <i class="fas fa-chart-line"></i><span>Estadísticas</span>
                    </a>
                    <a href="#" class="profile-hub-menu-item" data-filter="settings">
                        <i class="fas fa-cog"></i><span>Ajustes</span>
                    </a>
                    
                    <div style="margin-top: 20px;">
                        <a href="#" id="logout-btn-hub" class="profile-hub-menu-item logout" style="justify-content: center; background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3);">
                            <i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span>
                        </a>
                    </div>
                </div>

                <div id="hub-guest-content" style="display: none; text-align: center; padding: 30px 20px;">
                    <i class="fas fa-user-lock" style="font-size: 4rem; color: #444; margin-bottom: 20px;"></i>
                    <h3 style="margin: 0 0 10px 0; color: var(--text-light);">Modo Invitado</h3>
                    <button id="login-btn-hub" class="btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                </div>
            </div>

            <div id="profile-container" class="content-container" style="display: none;">
                <div class="profile-header-wrapper">
                    <div class="profile-main-info">
                        <div class="profile-avatar-placeholder"><i class="fas fa-user-circle"></i></div>
                        <div class="profile-text-info">
                            <h3 id="profile-username"></h3>
                            <p id="profile-email"></p>
                        </div>
                    </div>
                </div>
                <div class="profile-tab-content active" id="activity-tab">
                    <div class="stats-container">
                        <div class="stat-card"><i class="fas fa-film"></i><span id="stat-movies-watched" class="stat-value">0</span><span class="stat-label">Películas</span></div>
                        <div class="stat-card"><i class="fas fa-tv"></i><span id="stat-series-watched" class="stat-value">0</span><span class="stat-label">Series</span></div>
                    </div>
                    <div id="genre-stats-container"></div>
                </div>
            </div>

            <div id="settings-container" class="content-container" style="display: none;">
                <div class="content-header">
                    <h1 class="main-title">Ajustes</h1>
                </div>
                <div class="settings-form-wrapper">
                    <div class="settings-group">
                        <label>Nombre de usuario</label>
                        <div class="input-with-button">
                            <input type="text" id="settings-username-input">
                            <button id="update-username-btn" class="btn-primary">Guardar</button>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label>Contraseña</label>
                        <div class="input-with-button">
                            <input type="password" id="settings-password-input">
                            <button id="update-password-btn" class="btn-primary">Actualizar</button>
                        </div>
                    </div>
                    <p id="settings-feedback" class="feedback-message"></p>
                </div>
            </div>
        </main>
    </div>

    <div id="details-modal" class="modal">
        <div class="details-panel">
            <button class="close-btn">&times;</button>
            <div class="details-content">
                <div class="details-poster"><img id="details-poster-img" src="" alt="Poster"></div>
                <div class="details-info">
                    <h2 id="details-title"></h2>
                    <div class="details-meta">
                        <span id="details-year"></span>
                        <span id="details-language" style="display: none;"></span>
                        <span id="details-genres"></span>
                    </div>
                    <p id="details-synopsis"></p>
                    <div id="details-buttons"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="cinema" class="modal">
        <div class="cinema-wrapper">
            <div class="screen"><iframe src="" allowfullscreen></iframe></div>
            <div class="cinema-info"><h2 id="cinema-title"></h2><div class="cinema-controls"></div></div>
        </div>
        <button class="close-btn">&times;</button>
    </div>

    <div id="roulette-modal" class="modal">
        <div class="roulette-modal-content">
            <button class="close-btn">&times;</button>
            <h2>Película Aleatoria</h2>
            <div class="roulette-carousel-wrapper">
                <div id="roulette-carousel-track" class="roulette-carousel-track"></div>
                <div class="roulette-selector"></div>
            </div>
            <button id="spin-roulette-btn" class="btn-spin">Girar</button>
        </div>
    </div>

    <div id="series-player-modal" class="modal"></div>

    <div id="auth-modal" class="modal">
    <div class="auth-modal-content">
        <button class="close-btn">&times;</button>

        <form id="register-form" class="auth-form">
            <h2>Crear Cuenta</h2>
            <input type="text" id="register-username" placeholder="Usuario" required>
            <input type="email" id="register-email" placeholder="Email" required>
            
            <div class="password-wrapper">
                <input type="password" id="register-password" placeholder="Contraseña" required>
                <i class="fas fa-eye toggle-password" id="toggle-register-pass"></i>
            </div>
            
            <p id="register-error" class="auth-error"></p>
            <button type="submit">Registrarse</button>
        </form>

        <form id="login-form" class="auth-form" style="display:none;">
            <h2>Login</h2>
            <input type="email" id="login-email" placeholder="Email" required>
            
            <div class="password-wrapper">
                <input type="password" id="login-password" placeholder="Contraseña" required>
                <i class="fas fa-eye toggle-password" id="toggle-login-pass"></i>
            </div>
            
            <div class="forgot-container">
                <a href="#" id="forgot-password-link" class="forgot-link">¿Olvidaste tu contraseña?</a>
            </div>

            <p id="login-error" class="auth-error"></p>
            <button type="submit">Ingresar</button>
        </form>

        <form id="recovery-form" class="auth-form" style="display:none;">
            <h2>Recuperar</h2>
                <p style="color: #ccc; font-size: 0.9rem; margin-bottom: 20px; line-height: 1.5;">
                    Ingresa tu correo y te enviaremos un enlace para restablecer tu acceso.
                </p>
            <input type="email" id="recovery-email-input" placeholder="Tu Email registrado" required>
                
            <button type="submit">Enviar correo</button>

            <p class="spam-notice" style="font-size: 0.8rem; color: #888; margin-top: 10px; text-align: center;">
                <i class="fas fa-info-circle"></i> Si no recibes el correo, revisa tu carpeta de <strong>Spam</strong>.
            </p>
            <p id="recovery-message" class="auth-error"></p>
    
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" id="back-to-login-link" class="forgot-link">Volver a Iniciar Sesión</a>
            </div>
        </form>

        <p class="auth-switch"><a href="#" id="switch-auth-mode">¿No tienes cuenta? Regístrate</a></p>
    </div>
    </div>

    <div id="new-password-modal" class="modal">
    <div class="auth-modal-content">
        <h2 style="font-family: 'Bebas Neue'; font-size: 2.5rem; margin-bottom: 10px;">Restablecer Contraseña</h2>
        <p style="color: #ccc; margin-bottom: 20px;">Ingresa tu nueva clave para recuperar el acceso.</p>
        
        <form id="new-password-form" class="auth-form">
            <div class="password-wrapper">
                <input type="password" id="new-password-input" placeholder="Nueva contraseña" required minlength="6">
                <i class="fas fa-eye toggle-password" id="toggle-new-pass"></i>
            </div>
            <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">Guardar Nueva Contraseña</button>
        </form>
        
        <p id="new-pass-feedback" class="auth-error" style="margin-top: 15px; font-weight: bold;"></p>
    </div>
    </div>

    <div id="review-form-modal" class="modal">
        <div class="auth-modal-content" style="max-width: 500px;">
            <button class="close-btn">&times;</button>
            <form id="review-submission-form" class="auth-form">
                <h2 style="font-family: 'Bebas Neue'; font-size: 2.5rem;">Escribe tu opinión</h2>
                
                <label style="text-align: left; margin-bottom: 5px; color: var(--text-muted); display:block;">Título:</label>
                <div class="custom-select-wrapper">
                    <div class="custom-select-input-container">
                        <input type="text" id="review-movie-search" placeholder="Escribe para buscar..." autocomplete="off">
                        <i class="fas fa-chevron-down select-icon"></i>
                    </div>
                    
                    <input type="hidden" id="review-selected-id">

                    <div id="review-movie-options" class="custom-options-list"></div>
                </div>
                <label style="text-align: left; margin-bottom: 5px; color: var(--text-muted);">Calificación:</label>
                <div class="star-rating-input" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; font-size: 1.5rem;">
                    <i class="fas fa-star star-option" data-value="1"></i>
                    <i class="fas fa-star star-option" data-value="2"></i>
                    <i class="fas fa-star star-option" data-value="3"></i>
                    <i class="fas fa-star star-option" data-value="4"></i>
                    <i class="fas fa-star star-option" data-value="5"></i>
                </div>
                <input type="hidden" id="review-rating-value" value="0">
                
                <textarea id="review-text-input" placeholder="¿Qué te pareció? (Mínimo 2 letras)" required style="height: 120px; background: rgba(255,255,255,0.05); color: white; border: 1px solid #333; padding: 10px; border-radius: 8px; margin-bottom: 15px; resize: none;"></textarea>
                
                <button type="submit" class="btn-primary" style="width: 100%;">Publicar Reseña</button>
            </form>
        </div>
    </div>

    <div id="full-review-modal" class="modal">
        <div class="auth-modal-content" style="max-width: 600px; padding: 0; overflow: hidden; border-radius: 20px;">
            <button class="close-btn" onclick="closeAllModals()">&times;</button>
            <div id="read-review-header" style="height: 200px; background-size: cover; background-position: center; position: relative;">
                <div style="position: absolute; inset: 0; background: linear-gradient(to top, #181818, transparent);"></div>
                <div style="position: absolute; bottom: 20px; left: 30px; display: flex; gap: 20px; align-items: flex-end;">
                    <img id="read-review-poster" src="" style="width: 100px; height: 150px; border-radius: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.5);">
                    <div>
                        <h2 id="read-review-movie-title" style="font-family: 'Bebas Neue'; font-size: 2.5rem; margin: 0; color: white;"></h2>
                        <p id="read-review-user" style="color: var(--primary-red); font-weight: bold; margin: 0;"></p>
                    </div>
                </div>
            </div>
            <div style="padding: 30px; background: #181818; max-height: 400px; overflow-y: auto;">
                <div id="read-review-stars" style="color: #ffd700; font-size: 1.2rem; margin-bottom: 20px;"></div>
                <p id="read-review-text" style="color: #eee; line-height: 1.8; font-size: 1.1rem; font-style: italic; white-space: pre-wrap;"></p>
            </div>
            <div style="padding: 20px 30px; background: #111; border-top: 1px solid #222; text-align: right;">
                <span id="read-review-date" style="color: #555; font-size: 0.9rem; font-weight: bold;"></span>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="modal">
        <div class="confirmation-modal-content">
            <h2></h2><p></p>
            <div class="confirmation-buttons">
                <button id="cancel-delete-btn" class="btn-cancel">Cancelar</button>
                <button id="confirm-delete-btn" class="btn-confirm">Confirmar</button>
            </div>
        </div>
    </div>
    
    <footer class="bottom-nav">
        <a href="#" class="nav-link active" data-filter="all">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        
        <a href="#" class="nav-link" data-filter="movie">
            <i class="fas fa-film"></i>
            <span>Peliculas</span>
        </a>

        <a href="#" class="nav-link" data-filter="sagas">
            <i class="fas fa-layer-group"></i>
            <span>Universos</span>
        </a>

        <a href="#" class="nav-link" data-filter="series">
            <i class="fas fa-tv"></i>
            <span>Series</span>
        </a>

        <a href="#" class="nav-link" data-filter="profile-hub">
            <i class="fas fa-bars"></i>
            <span>Menú</span>
        </a>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="script.js?v=7" type="module" defer></script>
</body>
</html>
